---
title: "persist access token among requests for soundcloud php sdk "
layout: "post"
permalink: "/2013/03/soundcloud-access-token-persistance.html"
---

<div class="css-full-post-content js-full-post-content">
<div dir="ltr" style="text-align: left;" trbidi="on">Recently, My project requires integration with soundcloud to provide music discovery service.<br /><br />The official documents leads to this repository for php sdk&nbsp;<a href="https://github.com/mptre/php-soundcloud">https://github.com/mptre/php-soundcloud</a>.<br /><br />When using this sdk to implement oauth2 server side authentication process, we soon notice a problem:<br /><br />The access token fetched from soundcloud is not persistent among requests, which means every single time we want to make a api call to soundcloud, we need to run through the authentication process, even thought the access token fetched from previous request is still valid.<br /><br />There are 2 solutions to this problem:<br /><br /><b>1) The client side (client of php sdk) can apply the persistence logic by itself after fetching the access token.</b><br /><br />Example:<br /><br />after user authentication, &nbsp;sound cloud redirect to redirect url you set in the soundcloud app with code attached.<br /><br />$sc = new Services_Soundcloud(xxx,xxx, $redirect_uri);<br /><br />$access_token = $sc-&gt;accessToken($code);<br /><br />//here, we can save the access token to cookie or session or any other&nbsp;persistence methods, we use session here to demostrate<br /><br />$_SESSION['token'] = $access_token;<br /><br />in the next request, we can fetch this access token from session<br /><br />$access_token = $_SESSION['token']<br /><br />The problem for this solution is : &nbsp;client should consider to handle access token in their code, which increase works for the sdk users.<br /><br />Therefore, we can have the other solution, which manage access token persistance right in the sdk as a build-in feature<br /><br /><b>2) build-in access token persistance feature into soundcloud php sdk.</b><br /><br />the only change from client point of view is : they get the option to tell sdk if they want to persist access token or not.<br /><br />for the construction function, we add one more parameter $persistance which is false by default, in order to be compatible with current sdk interface.<br /><br />If client want to persist access token, just set this parameter to true, then the token is managed by the sdk automatically.<br /><br />The implementation is at this repository: &nbsp;<a href="https://github.com/fuyi/php-soundcloud">https://github.com/fuyi/php-soundcloud</a><br /><br />Currently, this is only one persistence method is implemented, Session. &nbsp;other mechanism like cookie, database could be added later on<br /><br /><br /><br /><br /></div>
</div>